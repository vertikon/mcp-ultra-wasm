# golangci-lint configuration for sdk-ultra-wasm
# Updated: 2025-10-12 - Removidas opções deprecated

run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

output:
  formats:
    - format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
  sort-results: true

issues:
  max-issues-per-linter: 0
  max-same-issues: 0
  new: false
  exclude-dirs:
    - vendor
    - _archive_validators
    - tmp
  exclude-files:
    - ".*\\.pb\\.go$"
    - ".*_gen\\.go$"

linters:
  enable:
    # Essential
    - errcheck        # Verifica erros não tratados
    - gosimple        # Simplificações de código
    - govet           # Go vet
    - ineffassign     # Detecta atribuições ineficazes
    - staticcheck     # Análise estática avançada
    - unused          # Código não usado (substitui deadcode/varcheck)
    - typecheck       # Type checking

    # Code quality
    - err113          # Erros wrapping (substitui goerr113)
    - errorlint       # Uso correto de errors.Is/As
    - gofmt           # Formatação
    - goimports       # Imports organizados
    - revive          # Linter rápido e configurável
    - misspell        # Typos em strings/comentários
    - unconvert       # Conversões desnecessárias
    - unparam         # Parâmetros não usados
    - mnd             # Magic numbers (substitui gomnd)

    # Security & Best practices
    - gosec           # Vulnerabilidades de segurança
    - nilnil          # Retornos nil, nil
    - noctx           # HTTP requests sem context
    - bodyclose       # HTTP response body close

    # Performance
    - prealloc        # Slice preallocation

    # Go 1.22+ (se aplicável)
    - copyloopvar     # Loop var scope (substitui exportloopref)

linters-settings:
  errcheck:
    check-type-assertions: true
    check-blank: true
    exclude-functions:
      - (io.Closer).Close
      - (*database/sql.Rows).Close

  err113:
    check-error-free-funcs: true

  errorlint:
    errorf: true
    errorf-multi: true
    asserts: true
    comparison: true

  govet:
    enable-all: true
    disable:
      - shadow  # Habilitado via linter separado se necessário

  staticcheck:
    checks: ["all"]

  revive:
    severity: warning
    rules:
      - name: blank-imports
      - name: context-as-argument
      - name: context-keys-type
      - name: dot-imports
      - name: error-return
      - name: error-strings
      - name: error-naming
      - name: exported
      - name: if-return
      - name: increment-decrement
      - name: var-naming
      - name: var-declaration
      - name: package-comments
      - name: range
      - name: receiver-naming
      - name: time-naming
      - name: unexported-return
      - name: indent-error-flow
      - name: errorf
      - name: empty-block
      - name: superfluous-else
      - name: unused-parameter
      - name: unreachable-code
      - name: redefines-builtin-id

  mnd:
    checks:
      - argument
      - case
      - condition
      - operation
      - return
    ignored-functions:
      - 'time.Sleep'
      - 'time.After'
      - 'time.NewTicker'
      - 'time.NewTimer'

  gosec:
    severity: medium
    confidence: medium
    excludes:
      - G104  # Handled by errcheck
      - G307  # Deferred close
